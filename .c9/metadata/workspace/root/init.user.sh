{"changed":true,"filter":false,"title":"init.user.sh","tooltip":"/root/init.user.sh","value":"#!/bin/sh\n\nsource ${HOME}/.bashrc &&\n    (cat <<EOF\n${AWS_ACCESS_KEY_ID}\n${AWS_SECRET_ACCESS_KEY}\n${AWS_DEFAULT_REGION}\n\nEOF\n    ) | aws configure &&\n    sed \\\n        -e \"s#\\${LIEUTENANT_PUBLIC_IP_ADDRESS}#$(aws ec2 describe-instances --filters Name=tag:moniker,Values=lieutenant Name=instance-state-name,Values=running --query \\\"Reservations[*].Instances[*].PublicIpAddress\\\" --output text)#\" \\\n        -e \"w/home/user/.ssh/config\" \\\n        /opt/docker/extension/config &&\n    echo \"${ORIGIN_ID_RSA}\" > /home/user/.ssh/origin.id_rsa &&\n    echo \"${UPSTREAM_ID_RSA}\" > /home/user/.ssh/upstream.id_rsa &&\n    echo \"${REPORT_ID_RSA}\" > /home/user/.ssh/report.id_rsa &&\n    echo \"${LIEUTENANT_AWS_PRIVATE_KEY}\" > /home/user/.ssh/lieutenant-ec2.id_rsa &&\n    ssh-keyscan -p ${HOST_PORT} \"${HOST_NAME}\" >> /home/user/.ssh/known_hosts &&\n    ssh-keyscan $(aws ec2 describe-instances --filters Name=tag:moniker,Values=lieutenant Name=instance-state-name,Values=running --query \\\"Reservations[*].Instances[*].PublicIpAddress\\\" --output text) >> /home/user/.ssh/known_hosts &&\n    ln -sf /home/user/.ssh /opt/docker/workspace/dot_ssh &&\n    TEMP=$(mktemp -d) &&\n    echo \"${GPG_SECRET_KEY}\" > ${TEMP}/gpg-secret-key &&\n    gpg --batch --import ${TEMP}/gpg-secret-key &&\n    echo \"${GPG2_SECRET_KEY}\" > ${TEMP}/gpg2-secret-key &&\n    gpg2 --batch --import ${TEMP}/gpg2-secret-key &&\n    echo \"${GPG_OWNER_TRUST}\" > ${TEMP}/gpg-owner-trust &&\n    gpg --batch --import-ownertrust ${TEMP}/gpg-owner-trust &&\n    echo \"${GPG2_OWNER_TRUST}\" > ${TEMP}/gpg2-owner-trust &&\n    gpg2 --batch --import-ownertrust ${TEMP}/gpg2-owner-trust &&\n    rm -rf ${TEMP} &&\n    pass init ${GPG_KEY_ID} &&\n    pass git init &&\n    pass git config user.name \"${USER_NAME}\" &&\n    pass git config user.email \"${USER_EMAIL}\" &&\n    pass git remote add origin origin:${SECRETS_ORIGIN_ORGANIZATION}/${SECRETS_ORIGIN_REPOSITORY}.git &&\n    echo \"${ORIGIN_ID_RSA}\" > /home/user/.ssh/origin_id_rsa &&\n    pass git fetch origin master &&\n    pass git checkout master &&\n    cp /opt/docker/extension/post-commit.sh ${HOME}/.password-store/.git/hooks/post-commit &&\n    chmod 0500 ${HOME}/.password-store/.git/hooks/post-commit &&\n    mkdir /opt/docker/workspace/ec2-user &&\n    sshfs -o allow_other lieutenant-ec2:/data /opt/docker/workspace/ec2-user/\n","undoManager":{"mark":-2,"position":4,"stack":[[{"start":{"row":10,"column":5},"end":{"row":10,"column":6},"action":"remove","lines":["l"],"id":2},{"start":{"row":10,"column":6},"end":{"row":10,"column":8},"action":"remove","lines":["ep"]},{"start":{"row":10,"column":6},"end":{"row":11,"column":3},"action":"insert","lines":["d \\","   "]},{"start":{"row":11,"column":4},"end":{"row":11,"column":7},"action":"remove","lines":["15s"]},{"start":{"row":11,"column":5},"end":{"row":12,"column":0},"action":"remove","lines":["&&",""]},{"start":{"row":11,"column":8},"end":{"row":11,"column":10},"action":"insert","lines":["-e"]},{"start":{"row":11,"column":11},"end":{"row":11,"column":28},"action":"insert","lines":["\"s#\\${LIEUTENANT_"]},{"start":{"row":11,"column":45},"end":{"row":11,"column":46},"action":"remove","lines":["="]},{"start":{"row":11,"column":45},"end":{"row":11,"column":47},"action":"insert","lines":["}#"]},{"start":{"row":11,"column":169},"end":{"row":11,"column":170},"action":"insert","lines":["\\"]},{"start":{"row":11,"column":215},"end":{"row":11,"column":216},"action":"insert","lines":["\\"]},{"start":{"row":11,"column":232},"end":{"row":16,"column":40},"action":"remove","lines":[" &&","    echo ${PUBLIC_IP_ADDRESS} &&","    sed \\","        -e \"s#127.0.0.1#${PUBLIC_IP_ADDRESS}#\" \\","        -e \"s#\\${HOST_NAME}#${HOST_NAME}#\" \\","        -e \"s#\\${HOST_PORT}#${HOST_PORT}"]},{"start":{"row":19,"column":138},"end":{"row":19,"column":139},"action":"insert","lines":["\\"]},{"start":{"row":19,"column":184},"end":{"row":19,"column":185},"action":"insert","lines":["\\"]},{"start":{"row":42,"column":0},"end":{"row":45,"column":0},"action":"insert","lines":["<<<<<<< HEAD","    sshfs -o allow_other lieutenant-ec2:/home/ec2-user /opt/docker/workspace/ec2-user/","=======",""]},{"start":{"row":46,"column":0},"end":{"row":47,"column":0},"action":"insert","lines":[">>>>>>> this should do it",""]}],[{"start":{"row":42,"column":0},"end":{"row":44,"column":7},"action":"remove","lines":["<<<<<<< HEAD","    sshfs -o allow_other lieutenant-ec2:/home/ec2-user /opt/docker/workspace/ec2-user/","======="],"id":3}],[{"start":{"row":41,"column":43},"end":{"row":42,"column":0},"action":"remove","lines":["",""],"id":4}],[{"start":{"row":43,"column":0},"end":{"row":43,"column":25},"action":"remove","lines":[">>>>>>> this should do it"],"id":5}],[{"start":{"row":42,"column":77},"end":{"row":43,"column":0},"action":"remove","lines":["",""],"id":6}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":42,"column":77},"end":{"row":42,"column":77},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1514721882471}