{"changed":true,"filter":false,"title":"init.user.sh","tooltip":"/root/init.user.sh","value":"#!/bin/sh\n\nsource ${HOME}/.bashrc &&\n    (cat <<EOF\n${AWS_ACCESS_KEY_ID}\n${AWS_SECRET_ACCESS_KEY}\n${AWS_DEFAULT_REGION}\n\nEOF\n    ) | aws configure &&\n    sleep 15s &&\n    PUBLIC_IP_ADDRESS=$(aws ec2 describe-instances --filters Name=tag:moniker,Values=lieutenant Name=instance-state-name,Values=running --query \"Reservations[*].Instances[*].PublicIpAddress\" --output text) &&\n    echo ${PUBLIC_IP_ADDRESS} &&\n    sed \\\n        -e \"s#127.0.0.1#${PUBLIC_IP_ADDRESS}#\" \\\n        -e \"s#\\${HOST_NAME}#${HOST_NAME}#\" \\\n        -e \"s#\\${HOST_PORT}#${HOST_PORT}#\" \\\n        -e \"w/home/user/.ssh/config\" \\\n        /opt/docker/extension/config &&\n    echo \"${ORIGIN_ID_RSA}\" > /home/user/.ssh/origin.id_rsa &&\n    echo \"${UPSTREAM_ID_RSA}\" > /home/user/.ssh/upstream.id_rsa &&\n    echo \"${REPORT_ID_RSA}\" > /home/user/.ssh/report.id_rsa &&\n    echo \"${LIEUTENANT_AWS_PRIVATE_KEY}\" > /home/user/.ssh/lieutenant-ec2.id_rsa &&\n    ssh-keyscan -p ${HOST_PORT} \"${HOST_NAME}\" >> /home/user/.ssh/known_hosts &&\n    ssh-keyscan $(aws ec2 describe-instances --filters Name=tag:moniker,Values=lieutenant Name=instance-state-name,Values=running --query \"Reservations[*].Instances[*].PublicIpAddress\" --output text) >> /home/user/.ssh/known_hosts &&\n    ln -sf /home/user/.ssh /opt/docker/workspace/dot_ssh &&\n    TEMP=$(mktemp -d) &&\n    echo \"${GPG_SECRET_KEY}\" > ${TEMP}/gpg-secret-key &&\n    gpg --batch --import ${TEMP}/gpg-secret-key &&\n    echo \"${GPG2_SECRET_KEY}\" > ${TEMP}/gpg2-secret-key &&\n    gpg2 --batch --import ${TEMP}/gpg2-secret-key &&\n    echo \"${GPG_OWNER_TRUST}\" > ${TEMP}/gpg-owner-trust &&\n    gpg --batch --import-ownertrust ${TEMP}/gpg-owner-trust &&\n    echo \"${GPG2_OWNER_TRUST}\" > ${TEMP}/gpg2-owner-trust &&\n    gpg2 --batch --import-ownertrust ${TEMP}/gpg2-owner-trust &&\n    rm -rf ${TEMP} &&\n    pass init ${GPG_KEY_ID} &&\n    pass git init &&\n    pass git config user.name \"${USER_NAME}\" &&\n    pass git config user.email \"${USER_EMAIL}\" &&\n    pass git remote add origin origin:${SECRETS_ORIGIN_ORGANIZATION}/${SECRETS_ORIGIN_REPOSITORY}.git &&\n    echo \"${ORIGIN_ID_RSA}\" > /home/user/.ssh/origin_id_rsa &&\n    pass git fetch origin master &&\n    pass git checkout master &&\n    cp /opt/docker/extension/post-commit.sh ${HOME}/.password-store/.git/hooks/post-commit &&\n    chmod 0500 ${HOME}/.password-store/.git/hooks/post-commit &&\n    mkdir /opt/docker/workspace/ec2-user &&\n    sshfs -o allow_other lieutenant-ec2:/data /opt/docker/workspace/ec2-user/\n","undoManager":{"mark":-2,"position":-1,"stack":[]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":0,"column":0},"end":{"row":0,"column":0},"isBackwards":true},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1514721772328}